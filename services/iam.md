# IAM

IAMはAWSリソースへのアクセスを制御するAWSのサービス。

(e.g. ○○さんには`S3`の□□というバケットへの読見込み/書き込みを許可する)

(e.g. △△さんには`DynamoDB`の××というテーブルの書き込みを許可する)

AWSのリソースを触るには必要となるサービスである。

## IAMの対象

アクセス制御の対象となるのは、主に`ユーザー`と`AWSリソース`、`ロール`である。

`ユーザー`: e.g. ○○というユーザーが`S3`のオブジェクトを作成することを許可する

`AWSリソース`: e.g. `Lambda`関数が`S3`のオブジェクトを作成することを許可する

`ロール`: e.g. △△というロールを引き受けた`ユーザー`や`AWSリソース`が、`S3`のオブジェクトを作成することを許可する

※AWSではあるサービスでのイベントをトリガーに、別のサービスの処理を実行するといった、イベント駆動型のサービスが多く提供されており、
`AWSリソース`へのアクセス制御が往々にしてある

## IAMの構成要素

IMAは主に`ユーザー`、`ポリシー`の概念を覚えておけば良い。

## ユーザー

### 認証の種類

- `ID/Password認証`: AWSマネジメントコンソールにログインするためのIDとパスワードの組
- `アクセスキー`: AWSのAPI、SDK、CLIを操作するための、アクセスキーIDとシークレットアクセスキーの組

### ユーザーの種類

ユーザーは`ID/Password認証`の有無で2種類に大別出来る。

- ユーザー: `ID/Password認証`が有効化された、「人」のためのユーザー
- サービスアカウント: `アクセスキー`のみが発行された、AWSへのリクエストを行うユーザー。スクリプトやCIなどを想定

## ポリシー

ポリシーはJSON形式で記述された、アクセス許可ルールのドキュメントである。

IAMのアクセス制御対象となる`ユーザー`、`AWSリソース`、`ロール`は`ポリシー`がアタッチされることではじめてAWSリソースにアクセスすることが出来る。

### JSONドキュメント

- Effect: 拒否 or 許可
- Action: どの操作を許可(拒否)するか
- Resouce: どのリソースに対して操作を許可(拒否)するか

JSONドキュメントの例:
```
{
  "Version": "2012-10-17",
  "Statement": {
    "Effect": "Allow",
    "Action": "s3:ListBucket",
    "Resource": "arn:aws:s3:::example_bucket"
  }
}
```

### ポリシーの種類

ポリシーには以下の種類がある。

- 管理ポリシー: AWSアカウント内に予め名前をつけて管理されているポリシーセット
  - AWS管理ポリシー: AWSがデフォルトで用意している管理ポリシー
  - カスタマー管理ポリシー: AWSアカウント内に自身で作成する管理ポリシー
- インラインポリシー: `ユーザー`、`AWSリソース`、`ロール`に直接JSONドキュメントを記載するポリシー

#### `AWS管理ポリシー`を積極的に使う

`AWS管理ポリシー`はAWSアカウント内に、大抵のユースケースを想定して予め用意されており、冗長なJSONドキュメントを管理しなくてすむため、積極的に使うとよい。

_案外、盲点。AWSマネジメントコンソールにて`IAM > ポリシー > フィルター`より一覧出来る_

## Tips; ロールの「委任」について

_TODO: 引っかかりポイントっぽいのでまとめる_
